<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AquaRank - Your Swimming Elo</title>
<style>
        :root {
            --primary-color: #005f73;
            --secondary-color: #0a9396;
            --accent-color: #94d2bd;
            --background-start: #e0fbfc;
            --background-mid: #cce3de;
            --background-end: #a9d6e5;
            --text-color: #001219;
            --card-bg-color: rgba(255, 255, 255, 0.9);
            --gold-color: #ffd700;
            --silver-color: #c0c0c0;
            --bronze-color: #cd7f32;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-family);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(-45deg, var(--background-start), var(--background-mid), var(--background-end));
            background-size: 400% 400%;
            animation: moveGradient 15s ease infinite;
        }

        .container {
            width: 100%;
            max-width: 700px;
            text-align: center;
        }

        header {
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 3rem;
            color: var(--primary-color);
            margin: 0;
            font-weight: 800;
            letter-spacing: -1px;
        }

        header h1 .highlight {
            color: var(--secondary-color);
        }

        header p {
            font-size: 1.1rem;
            color: var(--text-color);
            opacity: 0.8;
            max-width: 500px;
            margin: 10px auto 0;
        }

        .search-box {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        #swimmer-input {
            width: 100%;
            max-width: 300px;
            padding: 12px 15px;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: rgba(255,255,255,0.8);
        }

        #swimmer-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(10, 147, 150, 0.2);
        }

        #search-btn {
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        #search-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #search-btn:hover:not(:disabled) {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .results-container {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            width: 100%;
        }

        .results-container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .swimmer-card {
            background-color: var(--card-bg-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: left;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .swimmer-info h2 {
            margin: 0;
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .total-rank {
            text-align: right;
            display: flex;
            align-items: center;
        }

        .total-rank .rank-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--secondary-color);
            line-height: 1;
        }

        .total-rank .rank-label {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.7;
            letter-spacing: 0.5px;
        }

        .total-rank-score {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .total-grade-badge {
            padding: 6px 14px;
            font-size: 1.5rem;
            font-weight: 700;
            border-radius: 8px;
            margin-left: 15px;
            color: white;
        }

        .grade-SS {
            background: linear-gradient(90deg, #ff006e, #ff8fa3, #ff006e);
            background-size: 200% 100%;
            animation: shimmer-pink 3s ease-in-out infinite;
        }
        .grade-S { background-color: #ff69b4; }
        .grade-A-plus { background-color: #2a9d8f; }
        .grade-A { background-color: #80ed99; color: var(--text-color); }
        .grade-B { background-color: #fca311; }
        .grade-C { background-color: #fee440; color: var(--text-color); }
        .grade-D { background-color: #e63946; }


        .times-table {
            width: 100%;
            border-collapse: collapse;
        }

        .times-table th, .times-table td {
            padding: 12px 15px;
            text-align: left;
        }

        .times-table th {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-color);
            opacity: 0.6;
            border-bottom: 2px solid #f0f0f0;
        }

        .times-table tr:not(:last-child) td {
            border-bottom: 1px solid #f5f5f5;
        }

        .times-table td {
            font-size: 1rem;
        }

        .rank-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .rank-PRO {
            background: linear-gradient(90deg, #0077b6, #90e0ef, #0077b6);
            background-size: 200% 100%;
            animation: shimmer-blue 3s ease-in-out infinite;
            color: white;
            font-weight: 700;
        }
        .rank-AAAA { background-color: var(--gold-color); }
        .rank-AAA { background-color: var(--accent-color); }
        .rank-AA { background-color: var(--bronze-color); color: white; }
        .rank-A { background-color: var(--silver-color); }
        .rank-BB { background-color: #D5D5D5; }
        .rank-B { background-color: #EEEAEA; }
        .rank-LTB {
            background-color: #FAFAFA;
            color: var(--text-color);
        }

        .loading-spinner {
            display: none;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(0, 95, 115, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            color: #d90429;
            margin-top: 15px;
            display: none;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
        }

        footer {
            margin-top: 50px;
            font-size: 0.9rem;
            opacity: 0.8;
            color: #001219;
        }
    </style>
</head>
<body>
<div class="container">
<header>
<h1>Aqua<span class="highlight">Rank</span></h1>
<p>Enter a swimmer's name to find their best times and discover their total competitive rank. Share with friends and climb the leaderboard!</p>
</header>
<main>
<div class="search-box">
<input id="swimmer-input" placeholder="e.g., Caeleb Dressel" type="text"/>
<button id="search-btn">Get Rank</button>
</div>
<div class="loading-spinner" id="loading-spinner"></div>
<p class="error-message" id="error-message">Swimmer not found. Please try another name.</p>
<div class="results-container" id="results-container">
<div class="swimmer-card">
<div class="card-header">
<div class="swimmer-info">
<h2 id="swimmer-name"></h2>
<p id="swimmer-age-club" style="margin: 5px 0 0; font-size: 0.95rem; color: #555;"></p></div>
<div class="total-rank">
<div class="total-rank-score">
<div class="rank-value" id="total-rank-value"></div>
<div class="rank-label">Total Rank Score</div>
</div>
<div id="total-grade-badge"></div>
</div>
</div>
<table class="times-table" id="times-table-body">
<thead>
<tr>
<th>Event</th>
<th>Time</th>
<th>Standard</th>
<th>Score</th>
</tr>
</thead>
<tbody>
<!-- JS will populate this -->
</tbody>
</table>
</div>
</div>
</main>
<footer>
<p>Â© 2025 AquaRank. Data sourced from SwimCloud.</p>
</footer>
</div>

<script>
    // --- TIME STANDARDS (Unchanged) ---
    const timeStandards = {
        Male: {
            '10&Under': { "50 Free": { PRO: "", AAAA: 27.49, AAA: 28.69, AA: 29.89, A: 31.09, BB: 34.59, B: 38.19 }, "100 Free": { PRO: "", AAAA: 60.69, AAA: 63.79, AA: 66.79, A: 69.79, BB: 78.89, B: 87.99 }, "200 Free": { PRO: "", AAAA: 132.69, AAA: 138.99, AA: 145.29, A: 151.59, BB: 170.59, B: 189.49 }, "500 Free": { PRO: "", AAAA: 352.99, AAA: 369.79, AA: 386.59, A: 403.39, BB: 453.79, B: 504.29 }, "50 Back": { PRO: "", AAAA: 32.19, AAA: 33.99, AA: 35.79, A: 37.59, BB: 42.89, B: 48.29 }, "100 Back": { PRO: "", AAAA: 68.99, AAA: 72.49, AA: 76.09, A: 79.59, BB: 90.09, B: 100.69 }, "50 Breast": { PRO: "", AAAA: 36.39, AAA: 38.29, AA: 40.19, A: 42.09, BB: 47.69, B: 53.39 }, "100 Breast": { PRO: "", AAAA: 78.79, AAA: 82.69, AA: 86.59, A: 90.59, BB: 102.29, B: 114.09 }, "50 Fly": { PRO: "", AAAA: 30.79, AAA: 32.59, AA: 34.29, A: 35.99, BB: 41.29, B: 46.49 }, "100 Fly": { PRO: "", AAAA: 69.79, AAA: 74.59, AA: 79.49, A: 84.39, BB: 98.99, B: 113.49 }, "100 IM": { PRO: "", AAAA: 69.79, AAA: 73.09, AA: 76.39, A: 79.69, BB: 89.69, B: 99.69 }, "200 IM": { PRO: "", AAAA: 150.89, AAA: 158.39, AA: 165.89, A: 173.49, BB: 195.99, B: 218.59 }, },
            '11-12': { "50 Free": { PRO: "", AAAA: 24.59, AAA: 25.79, AA: 26.99, A: 28.09, BB: 30.49, B: 32.79 }, "100 Free": { PRO: "", AAAA: 53.59, AAA: 56.19, AA: 58.69, A: 61.29, BB: 66.39, B: 71.49 }, "200 Free": { PRO: "", AAAA: 116.99, AAA: 122.59, AA: 128.19, A: 133.69, BB: 144.89, B: 155.99 }, "500 Free": { PRO: "", AAAA: 314.99, AAA: 329.99, AA: 344.99, A: 359.99, BB: 389.99, B: 419.89 }, "1000 Free": { PRO: "", AAAA: 662.59, AAA: 694.19, AA: 725.79, A: 757.29, BB: 820.39, B: 883.49 }, "1650 Free": { PRO: "", AAAA: 1100.79, AAA: 1153.19, AA: 1205.59, A: 1257.09, BB: 1362.89, B: 1467.69 }, "50 Back": { PRO: "", AAAA: 28.19, AAA: 29.69, AA: 31.19, A: 32.69, BB: 35.59, B: 38.49 }, "100 Back": { PRO: "", AAAA: 59.49, AAA: 62.79, AA: 65.99, A: 69.29, BB: 75.69, B: 82.19 }, "200 Back": { PRO: "", AAAA: 129.69, AAA: 135.89, AA: 141.99, A: 148.19, BB: 160.49, B: 172.89 }, "50 Breast": { PRO: "", AAAA: 31.49, AAA: 33.29, AA: 34.99, A: 36.69, BB: 40.09, B: 43.49 }, "100 Breast": { PRO: "", AAAA: 67.79, AAA: 71.39, AA: 74.89, A: 78.39, BB: 85.49, B: 92.59 }, "200 Breast": { PRO: "", AAAA: 147.29, AAA: 154.39, AA: 161.39, A: 168.39, BB: 182.39, B: 196.39 }, "50 Fly": { PRO: "", AAAA: 26.69, AAA: 28.19, AA: 29.69, A: 31.19, BB: 34.19, B: 37.09 }, "100 Fly": { PRO: "", AAAA: 59.09, AAA: 62.49, AA: 65.89, A: 69.29, BB: 76.09, B: 82.89 }, "200 Fly": { PRO: "", AAAA: 132.39, AAA: 138.69, AA: 144.99, A: 151.39, BB: 163.99, B: 176.59 }, "100 IM": { PRO: "", AAAA: 61.09, AAA: 63.99, AA: 66.99, A: 69.99, BB: 75.89, B: 81.89 }, "200 IM": { PRO: "", AAAA: 132.09, AAA: 138.79, AA: 145.59, A: 152.29, BB: 165.79, B: 179.29 }, "400 IM": { PRO: "", AAAA: 282.79, AAA: 296.29, AA: 309.79, A: 323.19, BB: 350.09, B: 377.09 }, },
            "13-14": { "50 Free": { PRO: "21.69", AAAA: 22.39, AAA: 23.49, AA: 24.59, A: 25.59, BB: 27.69, B: 29.89 }, "100 Free": { PRO: "", AAAA: 48.69, AAA: 51.09, AA: 53.39, A: 55.69, BB: 60.29, B: 64.99 }, "200 Free": { PRO: "", AAAA: 106.89, AAA: 111.99, AA: 117.09, A: 122.19, BB: 132.29, B: 142.49 }, "500 Free": { PRO: "", AAAA: 289.29, AAA: 303.09, AA: 316.89, A: 330.59, BB: 358.19, B: 385.69 }, "1000 Free": { PRO: "", AAAA: 598.49, AAA: 626.99, AA: 655.49, A: 683.99, BB: 740.99, B: 797.99 }, "1650 Free": { PRO: "", AAAA: 1007.19, AAA: 1055.19, AA: 1103.09, A: 1151.09, BB: 1246.99, B: 1342.89 }, "50 Back": { PRO: "", AAAA: 25.29, AAA: 26.49, AA: 27.69, A: 28.89, BB: 31.29, B: 33.69 }, "100 Back": { PRO: "", AAAA: 53.49, AAA: 55.99, AA: 58.59, A: 61.09, BB: 66.19, B: 71.29 }, "200 Back": { PRO: "", AAAA: 115.99, AAA: 121.59, AA: 127.09, A: 132.59, BB: 143.69, B: 154.69 }, "50 Breast": { PRO: "", AAAA: 28.89, AAA: 30.29, AA: 31.69, A: 33.09, BB: 35.79, B: 38.59 }, "100 Breast": { PRO: "", AAAA: 60.39, AAA: 63.29, AA: 66.19, A: 68.99, BB: 74.79, B: 80.49 }, "200 Breast": { PRO: "", AAAA: 131.19, AAA: 137.39, AA: 143.59, A: 149.89, BB: 162.39, B: 174.89 }, "50 Fly": { PRO: "", AAAA: 24.89, AAA: 26.09, AA: 27.19, A: 28.39, BB: 30.79, B: 33.19 }, "100 Fly": { PRO: "", AAAA: 52.89, AAA: 55.39, AA: 57.89, A: 60.39, BB: 65.49, B: 70.49 }, "200 Fly": { PRO: "", AAAA: 117.59, AAA: 123.19, AA: 128.79, A: 134.39, BB: 145.59, B: 156.79 }, "200 IM": { PRO: "", AAAA: 118.49, AAA: 124.09, AA: 129.79, A: 135.39, BB: 146.69, B: 157.99 }, "400 IM": { PRO: "", AAAA: 253.29, AAA: 265.39, AA: 277.39, A: 289.49, BB: 313.59, B: 337.69 }, },
            "15-16": { "50 Free": { PRO: "20.69", AAAA: 21.19, AAA: 22.19, AA: 23.19, A: 24.19, BB: 26.29, B: 28.29 }, "100 Free": { PRO: "", AAAA: 46.49, AAA: 48.79, AA: 50.99, A: 53.19, BB: 57.59, B: 61.99 }, "200 Free": { PRO: "", AAAA: 101.99, AAA: 106.89, AA: 111.79, A: 116.59, BB: 126.29, B: 135.99 }, "500 Free": { PRO: "", AAAA: 276.29, AAA: 289.49, AA: 302.69, A: 315.79, BB: 342.09, B: 368.39 }, "1000 Free": { PRO: "", AAAA: 578.89, AAA: 603.39, AA: 627.99, A: 652.59, BB: 716.69, B: 770.79 }, "1650 Free": { PRO: "", AAAA: 964.99, AAA: 1010.89, AA: 1056.79, A: 1102.69, BB: 1194.69, B: 1286.59 }, "100 Back": { PRO: "", AAAA: 50.69, AAA: 53.09, AA: 55.49, A: 57.89, BB: 62.69, B: 67.49 }, "200 Back": { PRO: "", AAAA: 110.69, AAA: 115.99, AA: 121.29, A: 126.59, BB: 137.09, B: 147.59 }, "100 Breast": { PRO: "", AAAA: 57.69, AAA: 60.39, AA: 63.19, A: 65.89, BB: 71.39, B: 76.89 }, "200 Breast": { PRO: "", AAAA: 125.29, AAA: 131.29, AA: 137.29, A: 143.19, BB: 155.19, B: 167.09 }, "100 Fly": { PRO: "", AAAA: 50.39, AAA: 52.79, AA: 55.19, A: 57.59, BB: 62.39, B: 67.19 }, "200 Fly": { PRO: "", AAAA: 112.69, AAA: 118.09, AA: 123.49, A: 128.79, BB: 139.49, B: 150.19 }, "200 IM": { PRO: "", AAAA: 113.19, AAA: 118.59, AA: 123.99, A: 129.39, BB: 140.19, B: 150.89 }, "400 IM": { PRO: "", AAAA: 241.59, AAA: 253.19, AA: 264.79, A: 275.99, BB: 299.19, B: 322.39 }, },
            "17-18": { "50 Free": { PRO: "20.09", AAAA: 20.69, AAA: 21.69, AA: 22.59, A: 23.59, BB: 25.59, B: 27.59 }, "100 Free": { PRO: "", AAAA: 45.29, AAA: 47.39, AA: 49.59, A: 51.69, BB: 55.99, B: 60.29 }, "200 Free": { PRO: "", AAAA: 100.19, AAA: 104.99, AA: 109.69, A: 114.49, BB: 123.99, B: 133.19 }, "500 Free": { PRO: "", AAAA: 272.39, AAA: 285.39, AA: 298.39, A: 311.39, BB: 337.29, B: 363.19 }, "1000 Free": { PRO: "", AAAA: 570.19, AAA: 624.49, AA: 648.99, A: 675.59, BB: 705.89, B: 760.19 }, "1650 Free": { PRO: "", AAAA: 951.79, AAA: 997.09, AA: 1042.39, A: 1062.39, BB: 1102.69, B: 1249.39 }, "100 Back": { PRO: "", AAAA: 48.89, AAA: 51.29, AA: 53.59, A: 55.89, BB: 60.59, B: 65.19 }, "200 Back": { PRO: "", AAAA: 107.89, AAA: 113.09, AA: 118.19, A: 123.29, BB: 133.59, B: 143.89 }, "100 Breast": { PRO: "", AAAA: 55.99, AAA: 58.69, AA: 61.39, A: 63.99, BB: 69.39, B: 74.69 }, "200 Breast": { PRO: "", AAAA: 121.69, AAA: 127.49, AA: 133.29, A: 139.09, BB: 150.69, B: 162.29 }, "100 Fly": { PRO: "", AAAA: 49.09, AAA: 51.39, AA: 53.69, A: 56.09, BB: 60.79, B: 65.39 }, "200 Fly": { PRO: "", AAAA: 109.79, AAA: 115.09, AA: 120.29, A: 125.49, BB: 135.99, B: 146.39 }, "200 IM": { PRO: "", AAAA: 110.59, AAA: 115.89, AA: 121.09, A: 126.39, BB: 137.09, B: 148.19 }, "400 IM": { PRO: "", AAAA: 237.99, AAA: 249.39, AA: 260.69, A: 271.99, BB: 294.69, B: 317.39 }, }
        },
        Female: {
            '10&Under': { "50 Free": { PRO: "", AAAA: 28.29, AAA: 29.59, AA: 30.89, A: 32.09, BB: 35.99, B: 39.79 }, "100 Free": { PRO: "", AAAA: 61.79, AAA: 64.99, AA: 68.29, A: 71.49, BB: 81.09, B: 90.79 }, "200 Free": { PRO: "", AAAA: 136.19, AAA: 143.59, AA: 150.99, A: 158.39, BB: 180.59, B: 202.79 }, "500 Free": { PRO: "", AAAA: 361.69, AAA: 378.99, AA: 396.19, A: 413.39, BB: 465.09, B: 516.69 }, "50 Back": { PRO: "", AAAA: 32.59, AAA: 34.39, AA: 36.19, A: 37.99, BB: 43.29, B: 48.59 }, "100 Back": { PRO: "", AAAA: 70.59, AAA: 74.49, AA: 78.39, A: 82.29, BB: 93.99, B: 105.79 }, "50 Breast": { PRO: "", AAAA: 36.89, AAA: 38.89, AA: 40.89, A: 42.79, BB: 48.69, B: 54.59 }, "100 Breast": { PRO: "", AAAA: 80.19, AAA: 84.69, AA: 89.09, A: 93.59, BB: 106.89, B: 120.29 }, "50 Fly": { PRO: "", AAAA: 31.29, AAA: 33.19, AA: 35.09, A: 36.99, BB: 42.69, B: 48.39 }, "100 Fly": { PRO: "", AAAA: 70.89, AAA: 75.99, AA: 80.99, A: 86.09, BB: 101.39, B: 116.69 }, "100 IM": { PRO: "", AAAA: 70.99, AAA: 74.69, AA: 78.39, A: 82.09, BB: 93.19, B: 104.29 }, "200 IM": { PRO: "", AAAA: 152.19, AAA: 159.99, AA: 167.69, A: 175.49, BB: 198.79, B: 222.09 } },
            '11-12': { "50 Free": { PRO: "", AAAA: 25.79, AAA: 26.99, AA: 28.09, A: 29.29, BB: 31.69, B: 33.99 }, "100 Free": { PRO: "", AAAA: 55.99, AAA: 58.69, AA: 61.39, A: 63.99, BB: 69.39, B: 74.69 }, "200 Free": { PRO: "", AAAA: 121.89, AAA: 127.69, AA: 133.49, A: 139.29, BB: 150.89, B: 162.59 }, "500 Free": { PRO: "", AAAA: 327.69, AAA: 343.29, AA: 358.89, A: 374.49, BB: 405.69, B: 436.89 }, "1000 Free": { PRO: "", AAAA: 676.99, AAA: 709.29, AA: 741.49, A: 773.79, BB: 838.19, B: 902.69 }, "1650 Free": { PRO: "", AAAA: 1130.59, AAA: 1184.39, AA: 1238.19, A: 1292.09, BB: 1399.69, B: 1507.39 }, "50 Back": { PRO: "", AAAA: 29.09, AAA: 30.49, AA: 31.79, A: 33.19, BB: 35.99, B: 38.79 }, "100 Back": { PRO: "", AAAA: 62.69, AAA: 66.19, AA: 69.59, A: 72.99, BB: 79.79, B: 86.59 }, "200 Back": { PRO: "", AAAA: 134.59, AAA: 140.99, AA: 147.49, A: 153.89, BB: 166.69, B: 179.49 }, "50 Breast": { PRO: "", AAAA: 32.99, AAA: 34.59, AA: 36.19, A: 37.69, BB: 40.89, B: 43.99 }, "100 Breast": { PRO: "", AAAA: 71.49, AAA: 75.09, AA: 78.59, A: 82.19, BB: 89.29, B: 96.49 }, "200 Breast": { PRO: "", AAAA: 154.29, AAA: 161.69, AA: 168.99, A: 176.29, BB: 190.99, B: 205.69 }, "50 Fly": { PRO: "", AAAA: 27.69, AAA: 28.99, AA: 30.29, A: 31.59, BB: 34.29, B: 36.89 }, "100 Fly": { PRO: "", AAAA: 61.79, AAA: 65.19, AA: 68.59, A: 72.09, BB: 78.89, B: 85.79 }, "200 Fly": { PRO: "", AAAA: 137.59, AAA: 144.09, AA: 150.59, A: 157.19, BB: 170.29, B: 183.39 }, "100 IM": { PRO: "", AAAA: 63.89, AAA: 66.99, AA: 69.99, A: 73.09, BB: 79.09, B: 85.19 }, "200 IM": { PRO: "", AAAA: 137.89, AAA: 144.49, AA: 150.99, A: 157.59, BB: 170.69, B: 183.89 }, "400 IM": { PRO: "", AAAA: 293.79, AAA: 307.79, AA: 321.79, A: 335.79, BB: 363.69, B: 391.69 } },
            "13-14": { "50 Free": { PRO: "", AAAA: 24.39, AAA: 25.59, AA: 26.69, A: 27.89, BB: 30.19, B: 32.49 }, "100 Free": { PRO: "", AAAA: 53.29, AAA: 55.79, AA: 58.29, A: 60.89, BB: 65.89, B: 70.99 }, "200 Free": { PRO: "", AAAA: 115.29, AAA: 120.69, AA: 126.19, A: 131.69, BB: 142.69, B: 153.59 }, "500 Free": { PRO: "", AAAA: 309.19, AAA: 323.89, AA: 338.59, A: 353.39, BB: 382.79, B: 412.19 }, "1000 Free": { PRO: "", AAAA: 638.29, AAA: 668.69, AA: 699.09, A: 729.49, BB: 790.29, B: 851.09 }, "1650 Free": { PRO: "", AAAA: 1067.19, AAA: 1117.99, AA: 1168.79, A: 1219.59, BB: 1321.19, B: 1422.89 }, "100 Back": { PRO: "", AAAA: 57.69, AAA: 60.49, AA: 63.19, A: 65.89, BB: 71.39, B: 76.89 }, "200 Back": { PRO: "", AAAA: 124.79, AAA: 130.69, AA: 136.69, A: 142.59, BB: 154.49, B: 166.39 }, "100 Breast": { PRO: "", AAAA: 66.49, AAA: 69.69, AA: 72.89, A: 75.99, BB: 82.29, B: 88.69 }, "200 Breast": { PRO: "", AAAA: 143.29, AAA: 150.09, AA: 156.89, A: 163.79, BB: 177.39, B: 190.99 }, "100 Fly": { PRO: "", AAAA: 57.59, AAA: 60.39, AA: 63.09, A: 65.89, BB: 71.29, B: 76.79 }, "200 Fly": { PRO: "", AAAA: 128.39, AAA: 134.49, AA: 140.59, A: 146.69, BB: 158.99, B: 171.19 }, "200 IM": { PRO: "", AAAA: 128.79, AAA: 134.99, AA: 141.09, A: 147.19, BB: 159.49, B: 171.79 }, "400 IM": { PRO: "", AAAA: 274.29, AAA: 287.39, AA: 300.49, A: 313.49, BB: 339.69, B: 365.79 } },
            "15-16": { "50 Free": { PRO: "", AAAA: 23.89, AAA: 24.99, AA: 26.09, A: 27.29, BB: 29.49, B: 31.79 }, "100 Free": { PRO: "", AAAA: 51.59, AAA: 53.99, AA: 56.49, A: 58.89, BB: 63.79, B: 68.79 }, "200 Free": { PRO: "", AAAA: 111.79, AAA: 117.09, AA: 122.39, A: 127.69, BB: 138.39, B: 148.99 }, "500 Free": { PRO: "", AAAA: 300.79, AAA: 315.09, AA: 329.39, A: 343.69, BB: 372.39, B: 400.99 }, "1000 Free": { PRO: "", AAAA: 624.69, AAA: 654.49, AA: 684.19, A: 713.99, BB: 773.49, B: 832.89 }, "1650 Free": { PRO: "", AAAA: 1046.89, AAA: 1096.79, AA: 1146.69, A: 1196.49, BB: 1296.19, B: 1395.89 }, "100 Back": { PRO: "", AAAA: 56.09, AAA: 58.69, AA: 61.39, A: 64.09, BB: 69.39, B: 74.69 }, "200 Back": { PRO: "", AAAA: 121.69, AAA: 127.49, AA: 133.29, A: 139.09, BB: 150.59, B: 162.19 }, "100 Breast": { PRO: "", AAAA: 64.49, AAA: 67.49, AA: 70.59, A: 73.69, BB: 79.79, B: 85.89 }, "200 Breast": { PRO: "", AAAA: 139.49, AAA: 146.19, AA: 152.79, A: 159.39, BB: 172.69, B: 185.99 }, "100 Fly": { PRO: "", AAAA: 55.79, AAA: 58.39, AA: 61.09, A: 63.79, BB: 69.09, B: 74.39 }, "200 Fly": { PRO: "", AAAA: 124.39, AAA: 130.29, AA: 136.19, A: 142.09, BB: 153.99, B: 165.79 }, "200 IM": { PRO: "", AAAA: 124.59, AAA: 130.59, AA: 136.49, A: 142.39, BB: 154.29, B: 166.19 }, "400 IM": { PRO: "", AAAA: 266.29, AAA: 278.99, AA: 291.59, A: 304.29, BB: 329.69, B: 354.99 } },
            "17-18": { "50 Free": { PRO: "", AAAA: 23.49, AAA: 24.69, AA: 25.79, A: 26.89, BB: 29.09, B: 31.39 }, "100 Free": { PRO: "", AAAA: 51.09, AAA: 53.49, AA: 55.89, A: 58.39, BB: 63.19, B: 68.09 }, "200 Free": { PRO: "", AAAA: 110.39, AAA: 115.69, AA: 120.89, A: 126.19, BB: 136.69, B: 147.19 }, "500 Free": { PRO: "", AAAA: 297.39, AAA: 311.59, AA: 325.69, A: 339.89, BB: 368.19, B: 396.49 }, "1000 Free": { PRO: "", AAAA: 619.59, AAA: 649.09, AA: 678.59, A: 708.09, BB: 767.09, B: 826.09 }, "1650 Free": { PRO: "", AAAA: 1025.39, AAA: 1074.29, AA: 1123.09, A: 1171.89, BB: 1269.59, B: 1367.19 }, "100 Back": { PRO: "", AAAA: 54.99, AAA: 57.69, AA: 60.29, A: 62.89, BB: 68.09, B: 73.39 }, "200 Back": { PRO: "", AAAA: 119.09, AAA: 124.79, AA: 130.39, A: 136.09, BB: 147.39, B: 158.79 }, "100 Breast": { PRO: "", AAAA: 63.59, AAA: 66.69, AA: 69.69, A: 72.69, BB: 78.79, B: 84.79 }, "200 Breast": { PRO: "", AAAA: 138.49, AAA: 145.09, AA: 151.69, A: 158.29, BB: 171.49, B: 184.69 }, "100 Fly": { PRO: "", AAAA: 55.19, AAA: 57.79, AA: 60.39, A: 63.09, BB: 68.29, B: 73.59 }, "200 Fly": { PRO: "", AAAA: 122.09, AAA: 127.89, AA: 133.69, A: 139.49, BB: 151.19, B: 162.79 }, "200 IM": { PRO: "", AAAA: 122.69, AAA: 128.49, AA: 134.39, A: 140.19, BB: 151.89, B: 163.59 }, "400 IM": { PRO: "", AAAA: 262.99, AAA: 275.49, AA: 287.99, A: 300.59, BB: 325.59, B: 350.69 } }
        }
    };
    const rankPoints = { PRO: 1500, AAAA: 1000, AAA: 850, AA: 700, A: 550, BB: 400, B: 250 };
    const standardOrder = ['PRO', 'AAAA', 'AAA', 'AA', 'A', 'BB', 'B', 'LTB'];

    // --- CORE LOGIC (Mostly Unchanged) ---
    function getAgeGroup(age) {
        if (age <= 10) return '10&Under';
        if (age <= 12) return '11-12';
        if (age <= 14) return '13-14';
        if (age <= 16) return '15-16';
        return '17-18';
    }

    function calculateScoreForTime(event, swimmerTime, age, gender) {
        const genderStandards = timeStandards[gender];
        if (!genderStandards) return { score: 0, standard: 'N/A' };

        const ageGroup = getAgeGroup(age);
        const eventStandards = genderStandards[ageGroup]?.[event];
        if (!eventStandards) return { score: 0, standard: 'N/A' };

        if (eventStandards.PRO && swimmerTime <= eventStandards.PRO) {
            return { score: rankPoints.PRO, standard: 'PRO' };
        }

        for (let i = 0; i < standardOrder.length - 2; i++) {
            const upperStandardName = standardOrder[i];
            const lowerStandardName = standardOrder[i + 1];
            const upperTime = eventStandards[upperStandardName];
            const lowerTime = eventStandards[lowerStandardName];

            if (!upperTime || !lowerTime) continue;
            if (swimmerTime <= upperTime) return { score: rankPoints[upperStandardName], standard: upperStandardName };
            if (swimmerTime > upperTime && swimmerTime <= lowerTime) {
                const upperPoints = rankPoints[upperStandardName];
                const lowerPoints = rankPoints[lowerStandardName];
                const timeRange = lowerTime - upperTime;
                const pointRange = upperPoints - lowerPoints;
                if (timeRange <= 0) return { score: upperPoints, standard: upperStandardName };
                const timeProgress = swimmerTime - upperTime;
                const score = upperPoints - (timeProgress / timeRange) * pointRange;
                return { score: Math.round(score), standard: upperStandardName };
            }
        }

        if (swimmerTime > eventStandards.B) return { score: 0, standard: 'LTB' };
        return { score: rankPoints.B, standard: 'B' };
    }

    function getGradeForTotalScore(score) {
        if (score >= 4000) return 'SS';
        if (score >= 3500) return 'S';
        if (score >= 3100) return 'A+';
        if (score >= 2850) return 'A';
        if (score >= 2200) return 'B';
        if (score >= 1600) return 'C';
        return 'D';
    }

    function formatTime(totalSeconds) {
        if (totalSeconds === null || isNaN(totalSeconds)) return 'N/A';
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = (totalSeconds % 60).toFixed(2);
        const paddedSeconds = seconds < 10 ? '0' + seconds : seconds;
        return minutes > 0 ? `${minutes}:${paddedSeconds}` : seconds.replace(/^0+/, '');
    }

    function displayResults(swimmerData) {
        const { name, times, age, club, gender } = swimmerData;
        let totalRank = 0;

        document.getElementById('swimmer-name').textContent = name;
        document.getElementById('swimmer-age-club').textContent = `Age: ${age} â¢ ${gender} â¢ Club: ${club}`;
        const tableBodyEl = document.querySelector('#times-table-body tbody');
        tableBodyEl.innerHTML = '';

        times.forEach(t => {
            const result = calculateScoreForTime(t.event, t.time, age, gender);
            totalRank += result.score;
            const standardDisplay = result.standard === 'LTB' ? '&lt;B' : result.standard;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${t.event}</td>
                <td>${formatTime(t.time)}</td>
                <td><span class="rank-badge rank-${result.standard}">${standardDisplay}</span></td>
                <td>${Math.round(result.score)}</td>
            `;
            tableBodyEl.appendChild(row);
        });

        document.getElementById('total-rank-value').textContent = Math.round(totalRank);
        const grade = getGradeForTotalScore(totalRank);
        const totalGradeBadgeEl = document.getElementById('total-grade-badge');
        totalGradeBadgeEl.textContent = grade;
        totalGradeBadgeEl.className = `total-grade-badge grade-${grade.replace('+', '-plus')}`;

        document.getElementById('results-container').classList.add('visible');
    }

    // --- NEW: handleSearch function to call the backend ---
    async function handleSearch() {
        const input = document.getElementById('swimmer-input').value.trim();
        if (!input) return;

        const searchBtn = document.getElementById('search-btn');
        const spinner = document.getElementById('loading-spinner');
        const errorMessage = document.getElementById('error-message');
        const resultsContainer = document.getElementById('results-container');

        // Reset UI
        searchBtn.disabled = true;
        spinner.style.display = 'block';
        errorMessage.style.display = 'none';
        resultsContainer.classList.remove('visible');

        try {
            // Fetch data from our new backend server
            const response = await fetch(`/api/get-swimmer?name=${encodeURIComponent(input)}`);

            if (!response.ok) {
                const errData = await response.json();
                throw new Error(errData.error || 'Swimmer not found');
            }

            const swimmerData = await response.json();

            if (swimmerData && swimmerData.times.length > 0) {
                displayResults(swimmerData);
            } else {
                throw new Error('No valid times found for this swimmer.');
            }

        } catch (error) {
            console.error("Error fetching swimmer data:", error);
            errorMessage.textContent = error.message;
            errorMessage.style.display = 'block';
        } finally {
            // Re-enable button and hide spinner
            searchBtn.disabled = false;
            spinner.style.display = 'none';
        }
    }

    // --- EVENT LISTENERS ---
    document.getElementById('search-btn').addEventListener('click', handleSearch);
    document.getElementById('swimmer-input').addEventListener('keyup', (event) => {
        if (event.key === 'Enter') {
            handleSearch();
        }
    });

</script>
</body>
</html>
